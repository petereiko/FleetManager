@model FleetManager.Business.ViewModels.FuelLogInputViewModel
@{
    ViewData["Title"] = "Log Fuel Entry";
    Layout = "_Layout";
}


<style>
    .content-wrapper {
        padding: 1.5rem;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        min-height: 100vh;
    }

    .bg-gradient-primary {
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
    }

    .page-header-icon {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        width: 60px;
        height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .card {
        border-radius: 15px;
        overflow: hidden;
    }

    .card-header-icon {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .form-section {
        position: relative;
    }

    .section-title {
        font-size: 0.95rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #e9ecef;
    }

    .form-floating > .form-control,
    .form-floating > .form-select {
        border-radius: 10px;
        border: 2px solid #e9ecef;
        transition: all 0.3s ease;
    }

        .form-floating > .form-control:focus,
        .form-floating > .form-select:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.1);
        }

    .form-floating > label {
        font-weight: 500;
        color: #6c757d;
    }

    .upload-area {
        transition: all 0.3s ease;
        cursor: pointer;
    }

        .upload-area:hover {
            background-color: rgba(0, 123, 255, 0.05);
            border-color: #007bff !important;
        }

    .form-actions {
        background: rgba(0, 123, 255, 0.02);
        margin: 0 -1.5rem -1.5rem -1.5rem;
        padding: 1.5rem;
    }

    .btn {
        border-radius: 8px;
        font-weight: 500;
        transition: all 0.3s ease;
    }

    .btn-primary {
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
        border: none;
    }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }

    .invalid-feedback {
        font-size: 0.875rem;
        margin-top: 0.25rem;
    }

    .form-control.is-invalid,
    .form-select.is-invalid {
        border-color: #dc3545;
    }

    @@media (max-width: 768px) {
        .content-wrapper {
            padding: 1rem;
        }

        .page-header {
            text-align: center;
        }

        .page-header-icon {
            margin: 0 auto 1rem auto;
        }

        .form-actions {
            text-align: center;
        }

            .form-actions .d-flex {
                flex-direction: column;
                gap: 0.5rem;
            }
    }
</style>


<div class="content-wrapper">
    <!-- Page Header -->
    <div class="page-header bg-gradient-primary text-white rounded-3 mb-4 p-4 shadow-sm">
        <div class="d-flex align-items-center">
            <div class="page-header-icon me-3">
                <i class="fas fa-gas-pump fa-2x opacity-75"></i>
            </div>
            <div>
                <h2 class="page-title mb-1 fw-bold">@ViewData["Title"]</h2>
                <p class="page-subtitle mb-0 opacity-90">Record vehicle fuel consumption and expenses</p>
            </div>
        </div>
    </div>

    <!-- Main Content Card -->
    <div class="card border-0 shadow-lg">
        <div class="card-header bg-white border-bottom-0 p-4">
            <div class="d-flex align-items-center">
                <div class="card-header-icon bg-primary bg-opacity-10 rounded-circle p-2 me-3">
                    <i class="fas fa-clipboard-list text-primary"></i>
                </div>
                <div>
                    <h5 class="card-title mb-1 fw-semibold">Fuel Entry Details</h5>
                    <p class="card-subtitle text-muted mb-0 small">Fill in the required information below</p>
                </div>
            </div>
        </div>

        <div class="card-body p-4">
            <form asp-action="Create" method="post" enctype="multipart/form-data" id="fuelLogForm" novalidate>

                <!-- Primary Information Row -->
                <div class="form-section mb-4">
                    <h6 class="section-title text-primary fw-semibold mb-3 d-flex align-items-center">
                        <i class="fas fa-info-circle me-2"></i>
                        Primary Information
                    </h6>
                    <div class="row g-3">
                        <div class="col-lg-4 col-md-6">
                            <div class="form-floating">
                                <input asp-for="Date" class="form-control" type="date" id="dateInput" placeholder="Select Date" />
                                <label asp-for="Date" class="form-label">
                                    <i class="fas fa-calendar-alt me-1 text-muted"></i>Date
                                </label>
                                <span asp-validation-for="Date" class="invalid-feedback d-block"></span>
                            </div>
                        </div>

                        <div class="col-lg-4 col-md-6">
                            <div class="form-floating">
                                <select asp-for="VehicleId" class="form-select" id="vehicleSelect" asp-items="Model.Vehicles">
                                    <option value="">Choose vehicle...</option>
                                </select>
                                <label asp-for="VehicleId" class="form-label">
                                    <i class="fas fa-car me-1 text-muted"></i>Vehicle
                                </label>
                                <span asp-validation-for="VehicleId" class="invalid-feedback d-block"></span>
                            </div>
                        </div>

                        <div class="col-lg-4 col-md-6">
                            <div class="form-floating">
                                <select asp-for="FuelType" class="form-select" id="fuelTypeSelect" asp-items="Model.FuelTypes">
                                    <option value="">Choose fuel type...</option>
                                </select>
                                <label asp-for="FuelType" class="form-label">
                                    <i class="fas fa-tint me-1 text-muted"></i>Fuel Type
                                </label>
                                <span asp-validation-for="FuelType" class="invalid-feedback d-block"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Measurement Details Row -->
                <div class="form-section mb-4">
                    <h6 class="section-title text-primary fw-semibold mb-3 d-flex align-items-center">
                        <i class="fas fa-ruler me-2"></i>
                        Measurement Details
                    </h6>
                    <div class="row g-3">
                        <div class="col-lg-4 col-md-6">
                            <div class="form-floating">
                                <input asp-for="Odometer" class="form-control" type="number" step="0.1" id="odometerInput" placeholder="0.0" />
                                <label asp-for="Odometer" class="form-label">
                                    <i class="fas fa-tachometer-alt me-1 text-muted"></i>Odometer Reading (km)
                                </label>
                                <span asp-validation-for="Odometer" class="invalid-feedback d-block"></span>
                            </div>
                        </div>

                        <div class="col-lg-4 col-md-6">
                            <div class="form-floating">
                                <input asp-for="Volume" class="form-control" type="number" step="0.01" id="volumeInput" placeholder="0.00" />
                                <label asp-for="Volume" class="form-label">
                                    <i class="fas fa-fill-drip me-1 text-muted"></i>Fuel Volume (L)
                                </label>
                                <span asp-validation-for="Volume" class="invalid-feedback d-block"></span>
                            </div>
                        </div>

                        <div class="col-lg-4 col-md-6">
                            <div class="form-floating">
                                <input asp-for="Cost" class="form-control" type="number" step="0.01" id="costInput" placeholder="0.00" />
                                <label asp-for="Cost" class="form-label">
                                    <i class="fas fa-dollar-sign me-1 text-muted"></i>Total Cost
                                </label>
                                <span asp-validation-for="Cost" class="invalid-feedback d-block"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Additional Information Row -->
                <div class="form-section mb-4">
                    <h6 class="section-title text-primary fw-semibold mb-3 d-flex align-items-center">
                        <i class="fas fa-plus-circle me-2"></i>
                        Additional Information
                    </h6>
                    <div class="row g-3">
                        <div class="col-md-8">
                            <div class="form-floating">
                                <textarea asp-for="Notes" class="form-control" id="notesTextarea" placeholder="Enter any additional notes..." style="height: 100px;"></textarea>
                                <label asp-for="Notes" class="form-label">
                                    <i class="fas fa-sticky-note me-1 text-muted"></i>Notes (Optional)
                                </label>
                                <span asp-validation-for="Notes" class="invalid-feedback d-block"></span>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="upload-area border-2 border-dashed border-primary rounded-3 p-3 text-center h-100 d-flex flex-column justify-content-center">
                                <div class="upload-icon mb-2">
                                    <i class="fas fa-cloud-upload-alt fa-2x text-primary opacity-75"></i>
                                </div>
                                <label asp-for="ReceiptFile" class="form-label fw-semibold mb-2">Upload Receipt</label>
                                <input asp-for="ReceiptFile" type="file" class="form-control form-control-sm" accept="image/*,.pdf" id="receiptUpload" />
                                <small class="text-muted mt-1">PNG, JPG, PDF up to 10MB</small>
                                <span asp-validation-for="ReceiptFile" class="invalid-feedback d-block"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cost Per Liter Display -->
                <div class="alert alert-info border-0 bg-info bg-opacity-10 mb-4" id="costPerLiterAlert" style="display: none;">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-calculator me-2 text-info"></i>
                        <span class="fw-semibold">Cost per Liter: </span>
                        <span class="ms-2 fw-bold" id="costPerLiterValue">₦0.00</span>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="form-actions pt-3 border-top">
                    <div class="d-flex justify-content-end gap-2">
                        <a asp-action="Index" class="btn btn-outline-secondary btn-lg px-4">
                            <i class="fas fa-times me-2"></i>Cancel
                        </a>
                        <button type="submit" class="btn btn-primary btn-lg px-4" id="saveButton">
                            <i class="fas fa-save me-2"></i>Save Fuel Log
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>



    <partial name="_ValidationScriptsPartial" />
    <script>
        $(document).ready(function() {
            // Set today's date as default
            if (!$('#dateInput').val()) {
                $('#dateInput').val(new Date().toISOString().split('T')[0]);
            }

            // Calculate cost per liter
            function calculateCostPerLiter() {
                const volume = parseFloat($('#volumeInput').val()) || 0;
                const cost = parseFloat($('#costInput').val()) || 0;

                if (volume > 0 && cost > 0) {
                    const costPerLiter = cost / volume;
                    $('#costPerLiterValue').text('₦' + costPerLiter.toFixed(2));
                    $('#costPerLiterAlert').fadeIn();
                } else {
                    $('#costPerLiterAlert').fadeOut();
                }
            }

            // Bind calculation to input changes
            $('#volumeInput, #costInput').on('input', calculateCostPerLiter);

            // File upload preview
            $('#receiptUpload').on('change', function() {
                const file = this.files[0];
                if (file) {
                    const fileName = file.name;
                    const fileSize = (file.size / 1024 / 1024).toFixed(2);
                    $(this).siblings('small').text(`${fileName} (${fileSize} MB)`);
                }
            });

            // Form validation enhancement
            $('#fuelLogForm').on('submit', function(e) {
                const isValid = this.checkValidity();
                if (!isValid) {
                    e.preventDefault();
                    e.stopPropagation();

                    // Add visual feedback
                    $(this).addClass('was-validated');

                    // Scroll to first error
                    const firstError = $(this).find('.is-invalid').first();
                    if (firstError.length) {
                        $('html, body').animate({
                            scrollTop: firstError.offset().top - 100
                        }, 300);
                    }
                }
            });

            // Loading state for submit button
            $('#saveButton').on('click', function() {
                if ($('#fuelLogForm')[0].checkValidity()) {
                    $(this).prop('disabled', true)
                           .html('<i class="fas fa-spinner fa-spin me-2"></i>Saving...');
                }
            });
        });
    </script>
